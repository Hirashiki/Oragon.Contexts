<?xml version="1.0" encoding="utf-8" ?>

<objects
    xmlns="http://www.springframework.net"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.net/aop"
>

    <object name="TestService" type="Oragon.Architecture.LogEngine.ConsoleApp.Services.TestService, Oragon.Architecture.LogEngine.ConsoleApp">
        <property name="WriteDataProcess">
            <object type="Oragon.Architecture.LogEngine.Data.Process.PersistenceDataProcess, Oragon.Architecture.LogEngine.ConsoleApp" parent="APP_DB_PRINCIPAL_CONTEXT"></object>
        </property>
        <property name="AlunoDataProcess">
            <object type="Oragon.Architecture.LogEngine.Data.Process.AlunoDataProcess, Oragon.Architecture.LogEngine.ConsoleApp" parent="APP_DB_PRINCIPAL_CONTEXT"></object>
        </property>
        <property name="TipoTurmaDataProcess">
            <object type="Oragon.Architecture.LogEngine.Data.Process.TipoTurmaDataProcess, Oragon.Architecture.LogEngine.ConsoleApp" parent="APP_DB_PRINCIPAL_CONTEXT"></object>
        </property>
        <property name="TurmaDataProcess">
            <object type="Oragon.Architecture.LogEngine.Data.Process.TurmaDataProcess, Oragon.Architecture.LogEngine.ConsoleApp" parent="APP_DB_PRINCIPAL_CONTEXT"></object>
        </property>       
    </object>



    <object name="NHContextAroundAdvice" type="Oragon.Contexts.NHibernate.NHContextAroundAdvice, Oragon.Contexts.NHibernate" singleton="true">
        <property name="ElevateToSystemTransactionsIfRequired" value="false" />
        <property name="SessionFactoryBuilders">
            <list element-type="Oragon.Contexts.NHibernate.ISessionFactoryBuilder, Oragon.Contexts.NHibernate">
                <ref object="PrincipalDBSessionFactoryBuilder" />
            </list>
        </property>
    </object>

    <object name="APP_DB_PRINCIPAL_CONTEXT" abstract="true">
        <property name="ObjectContextKey" value="APP_DB_PRINCIPAL_CONTEXT" />
    </object>



    <object name="PrincipalDBSessionFactoryBuilder"
            type="Oragon.Contexts.NHibernate.FluentNHibernateSessionFactoryBuilderForSQLServer, Oragon.Contexts.FluentNHibernate"
            parent="APP_DB_PRINCIPAL_CONTEXT">

        <property name="DefaultIsolationLevel" value="ReadUncommitted" />
        <property name="TransactionIsolationLevel" value="ReadUncommitted" />
        <property name="DefaultFlushMode" value="Never" />
        <property name="TransactionFlushMode" value="Commit" />
        <property name="MaxFetchDepth" value="3" />
        <property name="EnabledDiagnostics" value="false" />
        <property name="CommandTimeout" value="20000" />
        <property name="BatchSize" value="50" />
        <property name="TypeNames">
            <list element-type="System.String">
                <value>Oragon.Architecture.LogEngine.Business.Entity.Turma, Oragon.Architecture.LogEngine.ConsoleApp</value>
            </list>
        </property>
        <property name="ConnectionStringDiscoverer">
            <object type="Oragon.Configuration.StaticConfigurationResolver, Oragon.Common">
                <property name="Configuration" value="Data Source=192.168.1.88;User ID=LogEngine;Password=LogEngine;Database=LogEngine;Application Name=ConsoleTest" />
            </object>
        </property>
    </object>

    <object name="AllServiceOperations" type="Oragon.Spring.Aop.Support.SdkRegularExpressionMethodPointcut, Oragon.Spring.Aop">
        <property name="Patterns">
            <list>
                <value>Oragon.Architecture.LogEngine.ConsoleApp.Services.*Service</value>
            </list>
        </property>
    </object>





    <aop:config>
        <aop:advisor pointcut-ref="AllServiceOperations" advice-ref="NHContextAroundAdvice" />

        <!-- Aspectos de tratamento de exceção devem ser os últimos-->
        <!-- NÃO COMENTAR! SE COMENTAR, LEMBRE-SE DE VOLTAR ANTES DE COMITAR. -->
        <!--<aop:advisor pointcut-ref="AllServiceOperations" advice-ref="ExceptionHandlerAroundAdvice" />-->
    </aop:config>


</objects>